name: Update Repository Count

on:
  schedule:
    - cron: '0 0 * * *'  # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å UTC
  workflow_dispatch:  # –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
  push:
    branches:
      - main

jobs:
  update-count:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get original repo count and update README
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö (–Ω–µ —Ñ–æ—Ä–∫–Ω—É—Ç—ã—Ö) –ø—É–±–ª–∏—á–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
          REPO_COUNT=$(gh repo list NickScherbakov --limit 1000 --json isFork --jq '[.[] | select(.isFork == false)] | length')
          
          echo "Original repositories count: $REPO_COUNT"
          
          # –û–±–Ω–æ–≤–∏—Ç—å —á–∏—Å–ª–æ –≤ README.md
          # –ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "X+original+projects" (URL-encoded) –∏ –∑–∞–º–µ–Ω—è–µ–º X –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ
          sed -i "s/[0-9]\++original+projects/${REPO_COUNT}+original+projects/g" README.md
          
          # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –±—ã–ª–∏ –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if git diff --quiet README.md; then
            echo "No changes needed"
            exit 0
          fi
          
          # –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "üìä Update original repositories count to $REPO_COUNT"
          git push
